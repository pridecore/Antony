import re

class IntentRecognizer:
    """
    Розпізнає наміри користувача за ключовими словами та шаблонами.
    Працює на основі регулярних виразів. Має розширене охоплення інтенцій.
    """

    def __init__(self):
        self.intent_patterns = {
            # Привітання
            "greeting": r"\b(привіт|хай|здорова|доброго дня|вечора|hello|hi|sup|yo)\b",

            # Прощання
            "farewell": r"\b(пака|вийти|до зустрічі|бувай|bye|goodbye|quit|exit|see you)\b",

            # Жарти, розваги
            "joke": r"\b(жарт|розсміши|анекдот|смішне|розваж)\b",
            "fun_fact": r"\b(цікавий факт|факт дня|здивуй мене)\b",

            # Погода, час
            "weather": r"\b(погода|на вулиці|температура|злива|дощ|сонце|шторм)\b",
            "time": r"\b(котра година|який час|time now|час|таймер|будильник)\b",

            # Хто ти, ідентичність
            "who_are_you": r"\b(хто ти|що ти таке|ти хто|представся|твоя мета|що ти вмієш)\b",
            "creator_question": r"\b(хто тебе створив|творець|розробник|developer)\b",

            # Філософія, духовність, існування
            "philosophy": r"\b(сенс життя|сенс|буття|існування|existence|чому|навіщо|why)\b",
            "spirituality": r"\b(бог|всесвіт|душа|карма|доля)\b",

            # Емоційний стан
            "status": r"\b(як ти|настрій|як справи|як себе почуваєш|як почуваєшся|status|emotion)\b",

            # Памʼять і нагадування
            "reminder": r"\b(нагадати|нагадування|план|розклад|постав мені|заплануй)\b",
            "memory_access": r"\b(ти пам’ятаєш|що я казав|запам’ятав|що я питав)\b",
            "memory_save": r"\b(запам’ятай|занотуй|запиши|додай до памʼяті)\b",

            # Пошук, відповіді, помічник
            "help": r"\b(допоможи|допомога|що ти вмієш|що можеш|команди|help|можеш зробити)\b",
            "search": r"\b(знайди|пошук|пошукай|інформація про|розкажи мені про)\b",

            "ethical_hacking": r"\b(хак|хакер|хакінг|хакни|етичний хакінг|pentest|penetration|penetration testing|vulnerability|вразливість|перевір безпеку|сканування портів|відкриті порти|аудит|безпековий аудит|firewall|фаєрвол|IDS|IPS|tcpdump|nmap|wireshark|ettercap|aircrack|osint|збір інформації|перевір мережу|відстежити|network scan|security scan|packet sniffer|system audit|backdoor|rootkit|відкриті порти|proxychains|spoofing|тест безпеки|threat|захист)\b",

            # Навчання, розвиток, навички
            "learn": r"\b(навчи мене|поясни|освіти|інструкція|як зробити|як працює)\b",

            # Керування пристроєм, дією
            "control": r"\b(включи|вимкни|запусти|зупини|відкрий|закрий|увімкни|гучність|яскравість)\b",

            # Безпека, моніторинг
            "security": r"\b(моніторинг|захист|безпека|порушення|перевір систему)\b",

            # Особисті справи
            "diary": r"\b(щоденник|запис у щоденник|особисте|моя історія)\b",
            "mood_log": r"\b(запиши мій настрій|мені сумно|мені радісно|втомився|втомлена)\b",

            # Роздуми, генерація
            "generate_text": r"\b(придумай|напиши|створи|згенеруй|опис|ідей|запит|історію)\b",
        }

    def recognize(self, text: str) -> str:
        """
        Розпізнає намір у тексті користувача. Повертає intent або 'unknown'.
        """
        text = text.lower()
        for intent, pattern in self.intent_patterns.items():
            if re.search(pattern, text):
                return intent
        return "unknown"


# Адаптер для сумісності з рештою коду
_intent_recognizer = IntentRecognizer()

def detect_intent(text: str) -> str:
    return _intent_recognizer.recognize(text)